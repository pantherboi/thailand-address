<html >
<head>
     <title>ที่อยู่ suggestion </title>
</head>     
<style>
.suggest-list {
    z-index: 50;
    position: absolute;
    z-index: 100;
    width: 100%;
    top: bottomTop;
    left: bottomLeft;
    width: bottomWidth;
    height: bottomHeight; 
}

.suggest-item {
     z-index: 100;
     /*border: 1px solid #eee;*/
     padding: 2px;
     background-color: white;
     cursor: pointer;
}
.suggest-item.hightlight {
     background-color: #f5f5f5;
}
.suggest-item-value {
     display: none;
}
</style>

<script>
  
     function removeAllChilds(ele){
          while (ele.firstChild) {
               ele.removeChild(ele.lastChild);
          }
     }
     function randomString(len){
          for(var c = ''; c.length < len;) c += Math.random().toString(36).substr(2, 1)
          return c;
     }
     function fetchSuggestItems(type,value,target1,target2,target3,target4){
          let items = new Array();

          const cnt = Math.random(1000)*1000%5;
          for(let i = 0 ; i< cnt; i++){
               const item = document.createElement("div");
               item.classList.add("suggest-item");
               item.innerHTML =  randomString(10) + " ? "+  randomString(10) + " ? "+  randomString(10)   + " ? "+  randomString(10);
               const subItem = document.createElement("div");
               subItem.classList.add("suggest-item-value");
               subItem.innerText = "1234,5616,5144,6677";

               item.addEventListener('mousedown',  function(e) {applyTargetAddress(target1,target2,target3,target4,subItem.innerText);item.parentElement.style.display ="none";});
                    item.addEventListener('mouseenter', function(e) {
                         const suggestItemElems = document.querySelectorAll('.suggest-item');
                         suggestItemElems.forEach(f => {
                              f.classList.remove('hightlight');
                         })
                         e.target.classList.add('hightlight');
               })
               item.appendChild(subItem);
               items.push(item);
          }
          
          return items;
     }

     function buildSuggestList(ele,type,listid,target1,target2,target3,target4){
          console.log("buildSuggestList");
          const suggestList = document.getElementById(listid);
          suggestList.style.display ="block";
          removeAllChilds(suggestList);
          const suggestItems =  fetchSuggestItems(type,ele.value,target1,target2,target3,target4);
          for(let  i = 0 ; i< suggestItems.length ; i++){
               const child = suggestItems[i];
               suggestList.appendChild(child);
               
          }
           ele.addEventListener('blur',function(event){suggestList.style.display ="none";});
     }
     function applyTargetAddress(target1,target2,target3,target4,targetValue ){
          console.log("applyTargetAddress");
          console.log(target1);
          console.log(target2);
          console.log(target3);
          console.log(target4);
          console.log(targetValue);
     }
</script>
<body>
     <h3> ข้อมูลส่วนบุคคล </h3>
     <table class="section-layout full-width" cellspacing="3" cellpadding="3">
          <tbody>
               <tr>
                    <td class="label">แขวง/ตำบล</td>
                    <td class="data">
                         <input name="formData.companyAddressDistrict" id="addr1" class="addrField" >
                         <div class="suggest-list" id="list1"></div>
                    </td>
               </tr>
               <tr>
                    <td class="label">เขต/อำเภอ</td>
                    <td class="data">
                         <input name="formData.companyAddressAmphur" id="addr2"  class="addrField">
                         <div class="suggest-list" id="list2"></div>
                    </td>
               </tr>
               <tr>
                    <td class="label">จังหวัด</td>
                    <td class="data">
                         <input name="formData.companyAddressProvince" id="addr3"  class="addrField">
                         <div class="suggest-list" id="list3"></div>
                    </td>
               </tr>
               <tr>
                    <td class="label">รหัสไปรษณีย์</td>
                    <td class="data">
                         <input name="formData.companyAddressPostalCode" id="addr4"  class="addrField">
                         <div class="suggest-list" id="list4"></div>
                    </td>
               </tr>
          </tbody>
     </table>

     <h3>ข้อมูลสถานประกอบการ </h3>
     <table class="section-layout full-width" cellspacing="3" cellpadding="3">
          <tbody>
               <tr>
                    <td class="label">แขวง/ตำบล</td>
                    <td class="data"><input name="formData.requesterAddressDistrict"></td>
               </tr>
               <tr>
                    <td class="label">เขต/อำเภอ</td>
                    <td class="data"><input name="formData.requesterAddressAmphur"></td>
               </tr>
               <tr>
                    <td class="label">จังหวัด</td>
                    <td class="data"><input name="formData.requesterAddressProvince"></td>
               </tr>
               <tr>
                    <td class="label">รหัสไปรษณีย์</td>
                    <td class="data"><input name="formData.requesterAddressPostalCode"></td>
               </tr>
          </tbody>
     </table>
</body>
<script>
     const addr1 = document.getElementById('addr1');
     const addr2 = document.getElementById('addr2');
     const addr3 = document.getElementById('addr3');
     const addr4 = document.getElementById('addr4');
     const handler1 = function(){buildSuggestList(addr1,'subdistrict','list1',addr1,addr2,addr3,addr4)};
     const handler2 = function(){buildSuggestList(addr2,'district','list2',addr1,addr2,addr3,addr4)};
     const handler3 = function(){buildSuggestList(addr3,'province','list3',addr1,addr2,addr3,addr4)};
     const handler4 = function(){buildSuggestList(addr4,'zipcode','list4',addr1,addr2,addr3,addr4)};

     addr1.addEventListener('focus', handler1);
     addr1.addEventListener('input', handler1);
     addr2.addEventListener('focus', handler2);
     addr2.addEventListener('input', handler2);
     addr3.addEventListener('focus', handler3);
     addr3.addEventListener('input', handler3);
     addr4.addEventListener('focus', handler4);
     addr4.addEventListener('input', handler4);

     var elements = document.getElementsByClassName("addrField");
     
     for (var i = 0; i < elements.length; i++) {
          elements[i].addEventListener('keydown', function(e){ 
               const suggestItems = e.target.parentElement.querySelectorAll('.suggest-item');
               
               let hightLightChildAt = -1 ;
              
               for(let i = 0 ; i < x.length ; i++){
                     if(suggestItems[i].classList.contains('hightlight')) {
                         hightLightChildAt = i; break;
                     } 
               }     
               
               const removeHightlight = function(targetEles){
                    for(let i = 0 ; i < targetEles.length ; i++)
                    targetEles[i].classList.remove('hightlight');
               }
               


               const pressed = event.key;
               console.log(pressed);
               console.log("before apply " + hightLightChildAt); 
               if(hightLightChildAt == -1){
                    removeHightlight();
                    console.log("apply " + 0);
                    suggestItems[0].classList.add('hightlight');
               }
               else if (pressed == 'ArrowDown') {
                    removeHightlight();
                    if(hightLightChildAt == suggestItems.length -1 ) hightLightChildAt = 0
                    else hightLightChildAt++;
                     console.log("apply " + hightLightChildAt);
                    suggestItems[hightLightChildAt].classList.add('hightlight');
               }
               else if (pressed == 'ArrowUp') {
                    removeHightlight();
                    if(hightLightChildAt == 0 ) hightLightChildAt =  suggestItems.length-1;
                    else hightLightChildAt--;
                     console.log("apply " + hightLightChildAt);
                    suggestItems[hightLightChildAt].classList.add('hightlight');
               }

          }, false);
     }
</script>
</html>